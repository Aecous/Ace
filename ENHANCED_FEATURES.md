# fscan 简化增强功能指南

## 🚀 **核心理念**

基于对fscanx和gogo项目的深入分析，我们采用了**简洁高效**的设计理念：
- **快速扫描优先** - 最大化扫描效率
- **基础反检测** - 简单有效的流量伪装  
- **轻量级设计** - 去除复杂的人类行为模拟
- **易于使用** - 参数简洁，开箱即用

## 📊 **速率控制核心**

### **简化的令牌桶算法** 
学习fscanx的设计，基于带宽的精确速率控制：
```
实际速率 = 基础带宽(1MB/s) × 速率倍数
每包间隔 = 包大小(64字节) ÷ 实际速率
```

### **三种扫描模式**
| 模式 | 速率倍数 | 抖动 | 特点 |
|------|---------|------|------|
| **fast** | 0.8 | 5% | 高速扫描，微量抖动 |
| **balanced** | 0.3 | 15% | 平衡模式，适度抖动 |
| **stealth** | 0.1 | 50% | 隐蔽模式，大幅随机化 |

## 🛠️ **命令行参数**

### **核心参数（学习fscanx）**
```bash
-prate     速率倍数 (0.0-1.0)，默认: 0.1
-pt        ping超时时间(秒)，默认: 6  
-iface     指定本地网卡IP地址
-rmode     速率扫描模式，默认: balanced
```

### **使用示例**
```bash
# 快速扫描模式
fscan -h 192.168.1.0/24 -rmode fast -prate 0.8

# 平衡模式（推荐）
fscan -h 192.168.1.0/24 -rmode balanced -prate 0.3

# 隐蔽扫描模式
fscan -h 192.168.1.0/24 -rmode stealth -prate 0.1

# 指定网卡进行扫描
fscan -h 192.168.1.0/24 -iface 192.168.1.100 -rmode balanced
```

## 🎯 **核心反检测技术**

### **1. 随机抖动**
避免固定频率发包，模拟真实网络抖动：
- **fast模式**: 30%概率添加微秒级抖动
- **balanced模式**: 15%随机抖动范围
- **stealth模式**: 50%大幅随机化

### **2. 随机突发**
模拟正常网络的突发流量：
- 5%概率触发突发模式
- 突发期间包间隔缩短50%
- 避免完全匀速的机器特征

### **3. 本地网卡指定**
支持多网卡环境的灵活配置：
```bash
# 指定特定网卡IP进行扫描
fscan -h target_network -iface 192.168.1.100
```

## 📈 **自适应速率控制**

### **简单有效的自适应算法**
```go
// 基于成功率的动态调整
if 成功率 < 80% {
    速率 = 当前速率 × 0.8  // 降速
} else if 成功率 > 95% {
    速率 = 当前速率 × 1.1  // 提速
}
```

### **触发条件**
- 发包数量 > 100
- 自动调整范围: 0.01 - 1.0
- 每10秒检查一次网络状况

## 🔧 **代码中的动态控制**

### **应用预设场景**
```go
// 快速扫描场景
Common.ApplyScenario("fast")

// 平衡扫描场景  
Common.ApplyScenario("balanced")

// 隐蔽扫描场景
Common.ApplyScenario("stealth")
```

### **动态调整速率**
```go
// 实时调整扫描速率
Common.UpdatePingRate(0.5)  // 设置为50%速率

// 获取当前状态
status := Common.GetRateStatus()
fmt.Println(status)
```

## 📊 **性能监控**

### **实时统计**
- 发包总数
- 成功数量  
- 实时PPS
- 成功率

### **状态查询**
```go
sent, success, pps, successRate := Common.PerfMonitor.GetStats()
```

## 🆚 **与原版对比**

| 特性 | 原版fscan | 简化增强版 |
|------|-----------|------------|
| 速率控制 | 硬编码并发限制 | 基于带宽的令牌桶 |
| 流量伪装 | 无 | 随机抖动+突发 |
| 参数配置 | 无用户配置 | 4个核心参数 |
| 检测规避 | 容易被识别 | 基础反检测 |
| 性能监控 | 无 | 实时统计 |
| 自适应 | 无 | 简单自适应调整 |

## 🎯 **推荐使用场景**

### **内网快速探测**
```bash
fscan -h 10.0.0.0/8 -rmode fast -prate 0.8
```

### **外网隐蔽扫描**  
```bash
fscan -h target_ip -rmode stealth -prate 0.05
```

### **日常安全评估**
```bash
fscan -h 192.168.1.0/24 -rmode balanced -prate 0.3
```

## ⚡ **性能提升**

相比原版fscan：
- ✅ **精确速率控制**: 从并发限制升级到字节级控制
- ✅ **基础反检测**: 降低被IDS发现的概率  
- ✅ **动态调整**: 根据网络状况自动优化
- ✅ **更好兼容性**: 支持多网卡环境
- ✅ **实时监控**: 提供详细的扫描统计

## 🔧 **技术实现亮点**

### **学习fscanx的精髓**
- 基于带宽的速率计算方式
- 简洁的令牌桶实现
- `Limiter.Wait(1)` 的精确等待

### **平衡速度与隐蔽性**
- 去除复杂的人类行为模拟
- 专注于必要的随机化技术
- 保持高效的扫描速度

### **简洁的架构设计**
- 单文件集成所有功能
- 最小化外部依赖
- 易于维护和扩展

---

**总结**: 通过学习fscanx和gogo的设计理念，我们创建了一个既快速又具备基础反检测能力的扫描工具。重点是**实用性**而非复杂性，确保在提升隐蔽性的同时保持优秀的扫描性能。 